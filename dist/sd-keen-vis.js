'use strict';(function(){Polymer({is:'sd-keen-vis',properties:{counterValue:{type:Number,value:0,notify:true},project:{type:String},readKey:{type:String},collection:{type:String},targetProperty:{type:String},groupBy:{type:Array,value:function value(){return[]}},filters:{type:Array,value:function value(){return[]}},analysisType:{type:String},timeframe:{type:String},interval:{type:String},yTitle:{type:String,value:'Hello'},chartYAxisConfig:{type:Object,notify:true,readOnly:true,value:function value(){return{}}},chartData:{type:Object,notify:true,reflectToAttribute:true,value:function value(){return{}},readOnly:true}},observers:['_initClient(project, key)','_updateQuery(collection, analysisType)'],created:function created(){this.chartConfig={seriesConfig:{}}},attached:function attached(){this._configureChart();this._updateQuery()},_initClient:function _initClient(){console.log('initClient');this.client=new Keen({projectId:this.project,readKey:this.readKey});this._updateQuery()},_configureChart:function _configureChart(){this._setChartYAxisConfig({'title':this.yTitle,'titleTruncation':false})},_updateQuery:function _updateQuery(){if(!this.client){this._initClient()}else{Keen.ready(function(){this.query=new Keen.Query(this.analysisType,{event_collection:this.collection,timeframe:this.timeframe,targetProperty:this.targetProperty,interval:this.interval,groupBy:this.groupBy,filters:this.filters});console.log(this.query);this._runQuery()}.bind(this))}},_runQuery:function _runQuery(){if(this.client){this.client.run(this.query,function(err,res){if(err){console.log(err)}else{console.log(res.result);window.result=res.result;var result=this._processResult(res.result);console.log(result);this._setChartData(result)}}.bind(this))}},_processResult:function _processResult(result){result=_.map(result,function(n){var x='';if(this.interval)var x=parseInt(moment(n.timeframe.end).format('x'));if(_.isArray(n.value)){var preval=_.map(n.value,function(v){var keys=_.pull(_.keys(v),'result');var y_str=_.reduce(keys,function(y_str,k){return y_str+v[k]},'');v['y_str']=y_str;return v});var chartData=_.reduce(preval,function(result,value,key){result[value.y_str]=value.result;return result},{});chartData['x']=x;return chartData}else return{'x':x,'y':n.value}}.bind(this));return result},handleClick:function handleClick(event,detail,sender){this.increment()},increment:function increment(){this.counterValue++}})})();
//# sourceMappingURL=sd-keen-vis.js.map
