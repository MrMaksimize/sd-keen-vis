{"version":3,"sources":["sd-keen-vis.es6.js"],"names":["Polymer","is","properties","counterValue","type","Number","value","notify","project","String","readKey","collection","targetProperty","groupBy","Array","filters","analysisType","timeframe","interval","yTitle","chartYAxisConfig","Object","readOnly","chartData","reflectToAttribute","observers","created","chartConfig","seriesConfig","attached","_configureChart","_updateQuery","_initClient","console","log","client","Keen","projectId","_setChartYAxisConfig","ready","query","Query","event_collection","_runQuery","bind","run","err","res","result","window","_processResult","_setChartData","_","map","n","x","parseInt","moment","end","format","isArray","preval","v","keys","pull","y_str","reduce","k","key","handleClick","event","detail","sender","increment"],"mappings":"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","file":"sd-keen-vis.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'sd-keen-vis',\n\n    properties: {\n        /**\n        * This property keeps track of the number of clicks.\n        *\n        * @property counterValue\n        */\n        counterValue: {\n            type: Number,\n            value: 0,\n            notify: true\n        },\n        project: {\n            type: String\n        },\n        readKey: {\n            type: String\n        },\n        collection: {\n            type: String\n        },\n        targetProperty: {\n            type: String\n        },\n        groupBy: {\n            type: Array,\n            value: function() {\n                return []\n            }\n        },\n        filters: {\n            type: Array,\n            value: function() {\n                return []\n            }\n        },\n        analysisType: {\n            type: String\n        },\n        timeframe: {\n            type: String\n        },\n        interval: {\n            type: String\n        },\n        yTitle: {\n            type: String,\n            value: 'Hello'\n        },\n        chartYAxisConfig: {\n            type: Object,\n            notify: true,\n            readOnly: true,\n            value: function() {\n                return {}\n            }\n        },\n        chartData: {\n            type: Object,\n            notify: true,\n            reflectToAttribute: true,\n            value: function() {\n                return {}\n            },\n            readOnly: true\n        }\n    },\n    observers: [\n        '_initClient(project, key)',\n        '_updateQuery(collection, analysisType)'\n    ],\n    created: function() {\n        this.chartConfig = {\n            seriesConfig: {}\n        };\n    },\n    attached: function() {\n       this._configureChart();\n       this._updateQuery();\n    },\n    _initClient: function() {\n        console.log('initClient');\n        this.client = new Keen({\n            projectId: this.project,\n            readKey: this.readKey\n        });\n       this._updateQuery();\n    },\n    _configureChart: function() {\n        this._setChartYAxisConfig({\n            \"title\": this.yTitle,\n            \"titleTruncation\": false\n        });\n    },\n    _updateQuery: function() {\n        if (!this.client) {\n            this._initClient()\n        }\n        else {\n            Keen.ready(function() {\n                this.query = new Keen.Query(this.analysisType, {\n                    event_collection: this.collection,\n                    timeframe: this.timeframe,\n                    targetProperty: this.targetProperty,\n                    interval: this.interval,\n                    groupBy: this.groupBy,\n                    filters: this.filters\n                });\n                console.log(this.query);\n                this._runQuery();\n            }.bind(this));\n        }\n    },\n    _runQuery: function() {\n        if (this.client) {\n            this.client.run(this.query, function(err, res){\n                if (err) {\n                    // there was an error!\n                    console.log(err);\n                }\n                else {\n                    console.log(res.result);\n                    window.result = res.result;\n                    var result = this._processResult(res.result)\n                    console.log(result);\n                    this._setChartData(result);\n                    /*result = _.map(result, function(n) {\n                        n = {\n                            'x': parseInt(moment(n.timeframe.end).format('x')),\n                            'y': n.value\n                        }\n                        return n;\n                    })*/\n                }\n            }.bind(this));\n        }\n    },\n    _processResult: function(result) {\n        result = _.map(result, function(n) {\n            // Intervals will automatically set x to timeseries.\n            var x = ''\n            if (this.interval)\n                var x = parseInt(moment(n.timeframe.end).format('x'))\n            //else\n            //    x = ''\n\n            // Check for grouping as value with groups comes back as array.\n            if (_.isArray(n.value)) {\n                var preval = _.map(n.value, function(v) {\n                    var keys = _.pull(_.keys(v), 'result')\n                    var y_str = _.reduce(keys, function(y_str, k) {\n                        return y_str + v[k]\n                    }, '')\n                    v['y_str'] = y_str;\n                    return v;\n                });\n                var chartData = _.reduce(preval, function(result, value, key) {\n                    result[value.y_str] = value.result;\n                    return result;\n                }, {});\n                chartData['x'] = x\n                return chartData;\n            }\n            else\n                return {'x': x, 'y': n.value}\n\n        }.bind(this));\n\n        return result;\n    },\n\n\n    /**\n    * Handles click on the element defined in 'on-click' on the template.\n    *\n    * @method handleClick\n    */\n    handleClick: function(event, detail, sender) {\n      this.increment();\n    },\n\n    /**\n    * Increments the counter\n    *\n    * @method increment\n    */\n    increment: function() {\n      this.counterValue++;\n    }\n  });\n})();\n"]}